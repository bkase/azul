{"id":"azul-85d","title":"RL Environment \u0026 Agent API","description":"Build reinforcement learning environment interface and agent API for Azul game","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-09T21:14:33.06036+01:00","updated_at":"2025-12-10T17:46:07.575561+01:00","closed_at":"2025-12-10T17:46:07.575561+01:00","labels":["api","environment","rl"]}
{"id":"azul-85d.1","title":"Define ActionId and Reward type aliases","description":"Create core RL type aliases in new rl_env module:\n- `pub type ActionId = u16;` (0..ACTION_SPACE_SIZE-1)\n- `pub type Reward = f32;`\n- `pub type Observation = mlx_rs::Array;` (f32, shape [obs_size])\nThese are the fundamental types that all other RL components will use. Observation invariant: rank 1, shape [obs_size], dtype f32.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:12:56.452959+01:00","updated_at":"2025-12-10T17:39:12.118954+01:00","closed_at":"2025-12-10T17:39:12.118954+01:00","dependencies":[{"issue_id":"azul-85d.1","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:12:56.453973+01:00","created_by":"bkase"},{"issue_id":"azul-85d.1","depends_on_id":"azul-85d.33","type":"blocks","created_at":"2025-12-10T17:19:08.219532+01:00","created_by":"bkase"}]}
{"id":"azul-85d.10","title":"Define FeatureExtractor trait","description":"Create FeatureExtractor trait for converting GameState to MLX Array observation:\n```rust\npub trait FeatureExtractor {\n    fn obs_size(\u0026self) -\u003e usize;  // Length of flattened observation vector\n    fn encode(\u0026self, state: \u0026GameState, player: PlayerIdx) -\u003e Observation;\n}\n```\nRequirements:\n- encode() is deterministic given (state, player)\n- Returns Array with rank 1, shape [obs_size()], dtype f32\n- No side effects or internal randomness\n- Must encode: boards, walls, pattern lines, floors, whose turn, factory state, center pool","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:14:49.280936+01:00","updated_at":"2025-12-10T17:40:01.130946+01:00","closed_at":"2025-12-10T17:40:01.130946+01:00","dependencies":[{"issue_id":"azul-85d.10","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:14:49.28153+01:00","created_by":"bkase"},{"issue_id":"azul-85d.10","depends_on_id":"azul-85d.1","type":"blocks","created_at":"2025-12-10T17:20:04.534958+01:00","created_by":"bkase"}]}
{"id":"azul-85d.11","title":"Implement create_zero_observation helper","description":"Create helper function for zero-filled observations:\n```rust\npub fn create_zero_observation(obs_size: usize) -\u003e Observation\n```\n- Returns MLX Array of zeros with shape [obs_size] and dtype f32\n- Used for unused player slots (indices \u003e= num_players)\n- Simple wrapper around MLX array creation API","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T17:14:55.812527+01:00","updated_at":"2025-12-10T17:40:06.299362+01:00","closed_at":"2025-12-10T17:40:06.299362+01:00","dependencies":[{"issue_id":"azul-85d.11","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:14:55.813311+01:00","created_by":"bkase"},{"issue_id":"azul-85d.11","depends_on_id":"azul-85d.10","type":"blocks","created_at":"2025-12-10T17:20:09.655411+01:00","created_by":"bkase"}]}
{"id":"azul-85d.12","title":"Implement concrete FeatureExtractor","description":"Implement a concrete FeatureExtractor (e.g., BasicFeatureExtractor):\nEncode at minimum:\n- All 5 factory displays (4 tiles each × 5 colors = one-hot or counts)\n- Center pool contents (color counts + first player marker)\n- For each player: pattern lines (5 rows, color + count), wall (5×5 binary), floor line (7 slots)\n- Current player indicator, starting player next round indicator\n- Scores (normalized)\nConsider multi-channel binary planes flattened to 1D. Document obs_size calculation.\nTarget: ~500-1500 features depending on encoding density.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:15:02.98382+01:00","updated_at":"2025-12-10T17:40:11.451928+01:00","closed_at":"2025-12-10T17:40:11.451928+01:00","dependencies":[{"issue_id":"azul-85d.12","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:15:02.984348+01:00","created_by":"bkase"},{"issue_id":"azul-85d.12","depends_on_id":"azul-85d.10","type":"blocks","created_at":"2025-12-10T17:20:14.789577+01:00","created_by":"bkase"},{"issue_id":"azul-85d.12","depends_on_id":"azul-85d.11","type":"blocks","created_at":"2025-12-10T17:20:19.920643+01:00","created_by":"bkase"}]}
{"id":"azul-85d.13","title":"Implement FeatureExtractor tests","description":"Tests for FeatureExtractor implementation:\n1. Shape test: For arbitrary reachable GameStates and players, obs.shape == [obs_size()]\n2. Dtype test: obs.dtype() == f32\n3. Rank test: obs.rank() == 1\n4. Determinism test: encode(state, player) == encode(state, player) on repeated calls\n5. Player perspective test: encode(state, 0) != encode(state, 1) when players have different boards\n6. Boundary test: obs_size() matches actual encoded length","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T17:15:09.884065+01:00","updated_at":"2025-12-10T17:45:31.061689+01:00","closed_at":"2025-12-10T17:45:31.061689+01:00","dependencies":[{"issue_id":"azul-85d.13","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:15:09.884597+01:00","created_by":"bkase"},{"issue_id":"azul-85d.13","depends_on_id":"azul-85d.12","type":"blocks","created_at":"2025-12-10T17:20:25.047291+01:00","created_by":"bkase"}]}
{"id":"azul-85d.14","title":"Define generic Environment trait","description":"Create generic Environment trait for RL:\n```rust\npub trait Environment {\n    type ObservationType;\n    type ActionType;\n    type RewardType;\n\n    fn reset(\u0026mut self, rng: \u0026mut impl Rng) -\u003e EnvStep\u003cSelf::ObservationType, Self::RewardType\u003e;\n    \n    fn step(\u0026mut self, action: Self::ActionType, rng: \u0026mut impl Rng) \n        -\u003e Result\u003cEnvStep\u003cSelf::ObservationType, Self::RewardType\u003e, StepError\u003e;\n}\n```\nThis trait abstracts the RL environment interface, making it reusable for other games.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:15:30.916774+01:00","updated_at":"2025-12-10T17:40:24.456827+01:00","closed_at":"2025-12-10T17:40:24.456827+01:00","dependencies":[{"issue_id":"azul-85d.14","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:15:30.917291+01:00","created_by":"bkase"},{"issue_id":"azul-85d.14","depends_on_id":"azul-85d.5","type":"blocks","created_at":"2025-12-10T17:20:34.357374+01:00","created_by":"bkase"},{"issue_id":"azul-85d.14","depends_on_id":"azul-85d.4","type":"blocks","created_at":"2025-12-10T17:20:39.490574+01:00","created_by":"bkase"}]}
{"id":"azul-85d.15","title":"Implement AzulEnv struct","description":"Create AzulEnv\u003cF: FeatureExtractor\u003e struct:\n```rust\npub struct AzulEnv\u003cF: FeatureExtractor\u003e {\n    pub game_state: GameState,\n    pub config: EnvConfig,\n    pub features: F,\n    pub last_action: Option\u003cActionId\u003e,\n    pub done: bool,\n}\n```\nInvariants:\n- game_state.num_players == config.num_players\n- done == (game_state.phase == Phase::GameOver)\n- If !done, then game_state.phase == Phase::FactoryOffer","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:15:37.306358+01:00","updated_at":"2025-12-10T17:40:29.621997+01:00","closed_at":"2025-12-10T17:40:29.621997+01:00","dependencies":[{"issue_id":"azul-85d.15","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:15:37.306987+01:00","created_by":"bkase"},{"issue_id":"azul-85d.15","depends_on_id":"azul-85d.10","type":"blocks","created_at":"2025-12-10T17:20:44.619256+01:00","created_by":"bkase"},{"issue_id":"azul-85d.15","depends_on_id":"azul-85d.3","type":"blocks","created_at":"2025-12-10T17:20:49.730776+01:00","created_by":"bkase"}]}
{"id":"azul-85d.16","title":"Implement AzulEnv::build_legal_action_mask","description":"Implement helper method for AzulEnv:\n```rust\nimpl\u003cF: FeatureExtractor\u003e AzulEnv\u003cF\u003e {\n    fn build_legal_action_mask(\u0026self) -\u003e Vec\u003cbool\u003e {\n        let mut mask = vec![false; ACTION_SPACE_SIZE];\n        for action in legal_actions(\u0026self.game_state) {\n            let id = ActionEncoder::encode(\u0026action) as usize;\n            mask[id] = true;\n        }\n        mask\n    }\n}\n```\nConverts engine's legal_actions() Vec\u003cAction\u003e into fixed-size boolean mask over action space.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:15:44.662721+01:00","updated_at":"2025-12-10T17:40:34.791546+01:00","closed_at":"2025-12-10T17:40:34.791546+01:00","dependencies":[{"issue_id":"azul-85d.16","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:15:44.663313+01:00","created_by":"bkase"},{"issue_id":"azul-85d.16","depends_on_id":"azul-85d.15","type":"blocks","created_at":"2025-12-10T17:20:54.868472+01:00","created_by":"bkase"},{"issue_id":"azul-85d.16","depends_on_id":"azul-85d.7","type":"blocks","created_at":"2025-12-10T17:21:00.005271+01:00","created_by":"bkase"}]}
{"id":"azul-85d.17","title":"Implement AzulEnv::new constructor","description":"Implement AzulEnv constructor:\n```rust\nimpl\u003cF: FeatureExtractor\u003e AzulEnv\u003cF\u003e {\n    pub fn new(config: EnvConfig, features: F) -\u003e Self {\n        // Create with placeholder game_state (will be initialized on reset)\n        // Or require rng and initialize immediately\n    }\n}\n```\nConsider: should constructor take rng and call reset(), or leave uninitialized until first reset()?","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:15:51.801744+01:00","updated_at":"2025-12-10T17:40:39.953199+01:00","closed_at":"2025-12-10T17:40:39.953199+01:00","dependencies":[{"issue_id":"azul-85d.17","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:15:51.802305+01:00","created_by":"bkase"},{"issue_id":"azul-85d.17","depends_on_id":"azul-85d.15","type":"blocks","created_at":"2025-12-10T17:21:05.147443+01:00","created_by":"bkase"}]}
{"id":"azul-85d.18","title":"Implement Environment::reset for AzulEnv","description":"Implement reset() for AzulEnv\u003cF\u003e:\n1. Create fresh GameState via new_game(num_players, starting_player, rng)\n2. Set last_action = None, done = false\n3. Build per-player observations: for idx 0..MAX_PLAYERS, if idx \u003c num_players then features.encode(state, idx), else create_zero_observation()\n4. Set rewards = [0.0; MAX_PLAYERS]\n5. Build legal_action_mask via build_legal_action_mask()\n6. Optionally clone state if include_full_state_in_step\n7. Return EnvStep with all fields populated","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:16:16.13087+01:00","updated_at":"2025-12-10T17:40:45.116728+01:00","closed_at":"2025-12-10T17:40:45.116728+01:00","dependencies":[{"issue_id":"azul-85d.18","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:16:16.13139+01:00","created_by":"bkase"},{"issue_id":"azul-85d.18","depends_on_id":"azul-85d.14","type":"blocks","created_at":"2025-12-10T17:21:21.122183+01:00","created_by":"bkase"},{"issue_id":"azul-85d.18","depends_on_id":"azul-85d.16","type":"blocks","created_at":"2025-12-10T17:21:26.252569+01:00","created_by":"bkase"},{"issue_id":"azul-85d.18","depends_on_id":"azul-85d.12","type":"blocks","created_at":"2025-12-10T17:21:31.384505+01:00","created_by":"bkase"}]}
{"id":"azul-85d.19","title":"Implement Environment::step for AzulEnv","description":"Implement step() for AzulEnv\u003cF\u003e:\n1. Check self.done -\u003e return Err(StepError::EpisodeDone)\n2. Decode action_id via ActionEncoder::decode()\n3. Check legality via build_legal_action_mask() -\u003e return Err(StepError::IllegalAction) if false\n4. Record prev_scores for all players\n5. Apply action via apply_action(state, action, rng)\n6. Compute rewards based on RewardScheme (DenseScoreDelta or TerminalOnly)\n7. Update done flag based on phase\n8. Build new observations for all players\n9. Build new legal_action_mask (or all-false if done)\n10. Return Ok(EnvStep{...})","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:16:22.786988+01:00","updated_at":"2025-12-10T17:40:50.276782+01:00","closed_at":"2025-12-10T17:40:50.276782+01:00","dependencies":[{"issue_id":"azul-85d.19","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:16:22.78757+01:00","created_by":"bkase"},{"issue_id":"azul-85d.19","depends_on_id":"azul-85d.18","type":"blocks","created_at":"2025-12-10T17:21:36.504462+01:00","created_by":"bkase"}]}
{"id":"azul-85d.2","title":"Implement RewardScheme enum","description":"Create RewardScheme enum with two variants:\n- `DenseScoreDelta`: reward[player] = score_after[player] - score_before[player] at every step, including final bonuses at terminal step\n- `TerminalOnly`: rewards are 0 until game over; at game over: reward[player] = final_score[player] - mean(final_scores)\nDerive Copy, Clone, Debug. Future extension: add Shaped reward scheme.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:13:18.873918+01:00","updated_at":"2025-12-10T17:39:17.284205+01:00","closed_at":"2025-12-10T17:39:17.284205+01:00","dependencies":[{"issue_id":"azul-85d.2","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:13:18.874507+01:00","created_by":"bkase"},{"issue_id":"azul-85d.2","depends_on_id":"azul-85d.33","type":"blocks","created_at":"2025-12-10T17:19:13.346876+01:00","created_by":"bkase"}]}
{"id":"azul-85d.20","title":"Implement DenseScoreDelta reward computation","description":"In Environment::step, for RewardScheme::DenseScoreDelta:\n```rust\nfor p in 0..num_players {\n    let new_score = game_state.players[p].score;\n    let delta = (new_score - prev_scores[p]) as f32;\n    rewards[p] = delta;\n}\n```\n- Computes incremental score change at every step\n- Includes all bonuses at terminal step (row/column/color completion)\n- Good for faster learning signal","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:16:29.744767+01:00","updated_at":"2025-12-10T17:41:05.496681+01:00","closed_at":"2025-12-10T17:41:05.496681+01:00","dependencies":[{"issue_id":"azul-85d.20","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:16:29.745301+01:00","created_by":"bkase"},{"issue_id":"azul-85d.20","depends_on_id":"azul-85d.19","type":"blocks","created_at":"2025-12-10T17:21:41.635812+01:00","created_by":"bkase"}]}
{"id":"azul-85d.21","title":"Implement TerminalOnly reward computation","description":"In Environment::step, for RewardScheme::TerminalOnly:\n```rust\nif phase == Phase::GameOver {\n    let final_scores: Vec\u003cf32\u003e = players.iter().map(|p| p.score as f32).collect();\n    let mean = final_scores.iter().sum::\u003cf32\u003e() / num_players as f32;\n    for p in 0..num_players {\n        rewards[p] = final_scores[p] - mean;\n    }\n} else {\n    // rewards remain [0.0; MAX_PLAYERS]\n}\n```\n- Zero reward until game ends\n- Final reward = player's score minus average score (zero-sum)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:16:36.114238+01:00","updated_at":"2025-12-10T17:41:10.560631+01:00","closed_at":"2025-12-10T17:41:10.560631+01:00","dependencies":[{"issue_id":"azul-85d.21","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:16:36.11478+01:00","created_by":"bkase"},{"issue_id":"azul-85d.21","depends_on_id":"azul-85d.19","type":"blocks","created_at":"2025-12-10T17:21:46.772657+01:00","created_by":"bkase"}]}
{"id":"azul-85d.22","title":"Implement AgentInput struct","description":"Create AgentInput struct for agent action selection:\n```rust\npub struct AgentInput\u003c'a\u003e {\n    pub observation: \u0026'a Observation,      // Obs for current player\n    pub legal_action_mask: \u0026'a [bool],     // mask[id]=true if legal\n    pub current_player: PlayerIdx,          // Whose turn it is\n}\n```\nLifetime 'a borrows from EnvStep to avoid unnecessary cloning.\nThis is the minimal input an agent needs to select an action.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:17:02.938952+01:00","updated_at":"2025-12-10T17:41:15.73132+01:00","closed_at":"2025-12-10T17:41:15.73132+01:00","dependencies":[{"issue_id":"azul-85d.22","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:17:02.939522+01:00","created_by":"bkase"},{"issue_id":"azul-85d.22","depends_on_id":"azul-85d.1","type":"blocks","created_at":"2025-12-10T17:21:54.25909+01:00","created_by":"bkase"}]}
{"id":"azul-85d.23","title":"Define Agent trait","description":"Create Agent trait for action selection:\n```rust\npub trait Agent {\n    fn select_action(\n        \u0026mut self, \n        input: \u0026AgentInput, \n        rng: \u0026mut impl Rng\n    ) -\u003e ActionId;\n}\n```\nRequirements:\n- Must only return ActionIds where legal_action_mask[id] == true\n- May use rng for exploration (epsilon-greedy, sampling, etc.)\n- Works for: random policy, neural net policy, MCTS, human input","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:17:09.185281+01:00","updated_at":"2025-12-10T17:41:20.801168+01:00","closed_at":"2025-12-10T17:41:20.801168+01:00","dependencies":[{"issue_id":"azul-85d.23","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:17:09.185875+01:00","created_by":"bkase"},{"issue_id":"azul-85d.23","depends_on_id":"azul-85d.22","type":"blocks","created_at":"2025-12-10T17:21:59.388045+01:00","created_by":"bkase"}]}
{"id":"azul-85d.24","title":"Implement RandomAgent","description":"Implement a simple RandomAgent for testing and baseline:\n```rust\npub struct RandomAgent;\n\nimpl Agent for RandomAgent {\n    fn select_action(\u0026mut self, input: \u0026AgentInput, rng: \u0026mut impl Rng) -\u003e ActionId {\n        let legal_ids: Vec\u003cActionId\u003e = input.legal_action_mask\n            .iter()\n            .enumerate()\n            .filter(|(_, \u0026legal)| legal)\n            .map(|(id, _)| id as ActionId)\n            .collect();\n        legal_ids[rng.gen_range(0..legal_ids.len())]\n    }\n}\n```\nUseful for smoke testing the environment loop.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T17:17:15.406609+01:00","updated_at":"2025-12-10T17:41:25.962864+01:00","closed_at":"2025-12-10T17:41:25.962864+01:00","dependencies":[{"issue_id":"azul-85d.24","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:17:15.408222+01:00","created_by":"bkase"},{"issue_id":"azul-85d.24","depends_on_id":"azul-85d.23","type":"blocks","created_at":"2025-12-10T17:22:04.524673+01:00","created_by":"bkase"}]}
{"id":"azul-85d.25","title":"Implement self_play_episode example function","description":"Implement reference self-play loop:\n```rust\npub fn self_play_episode\u003cF: FeatureExtractor, A: Agent\u003e(\n    env: \u0026mut AzulEnv\u003cF\u003e,\n    agent: \u0026mut A,\n    rng: \u0026mut impl Rng,\n    replay_buffer: \u0026mut Vec\u003cTransition\u003e,\n) {\n    let mut step = env.reset(rng);\n    while !step.done {\n        let p = step.current_player as usize;\n        let input = AgentInput { observation: \u0026step.observations[p], ... };\n        let action_id = agent.select_action(\u0026input, rng);\n        let next_step = env.step(action_id, rng).expect(\"step failed\");\n        replay_buffer.push(Transition { ... });\n        step = next_step;\n    }\n}\n```\nDemonstrates how to use the API for training data collection.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T17:17:22.473566+01:00","updated_at":"2025-12-10T17:45:25.918807+01:00","closed_at":"2025-12-10T17:45:25.918807+01:00","dependencies":[{"issue_id":"azul-85d.25","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:17:22.474086+01:00","created_by":"bkase"},{"issue_id":"azul-85d.25","depends_on_id":"azul-85d.24","type":"blocks","created_at":"2025-12-10T17:22:09.656884+01:00","created_by":"bkase"},{"issue_id":"azul-85d.25","depends_on_id":"azul-85d.19","type":"blocks","created_at":"2025-12-10T17:22:14.782959+01:00","created_by":"bkase"}]}
{"id":"azul-85d.26","title":"Implement legal action mask correctness tests","description":"Test legal_action_mask consistency with engine (Section 12.2):\nFor many random reachable GameStates:\n1. Compute legal = legal_actions(\u0026game_state)\n2. Compute mask = env.build_legal_action_mask()\n3. For each a in legal: id = encode(\u0026a) → assert mask[id] == true\n4. For each id with mask[id] == true: a = decode(id) → assert a is in legal\nThis ensures bijection between engine's legal_actions and mask's true entries.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:17:45.077218+01:00","updated_at":"2025-12-10T17:44:22.853926+01:00","closed_at":"2025-12-10T17:44:22.853926+01:00","dependencies":[{"issue_id":"azul-85d.26","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:17:45.077807+01:00","created_by":"bkase"},{"issue_id":"azul-85d.26","depends_on_id":"azul-85d.16","type":"blocks","created_at":"2025-12-10T17:22:32.210388+01:00","created_by":"bkase"}]}
{"id":"azul-85d.27","title":"Implement DenseScoreDelta reward correctness tests","description":"Test DenseScoreDelta reward scheme (Section 12.3):\nRun full random episodes:\n1. Track per-player cumulative reward: cum_reward[p] = Σ_t reward_t[p]\n2. At end, check: cum_reward[p] == final_score[p] - initial_score[p]\n   (initial_score is always 0)\n3. Verify step rewards match engine scoring exactly\nThis ensures our incremental rewards sum to final scores.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:17:51.02908+01:00","updated_at":"2025-12-10T17:44:28.019181+01:00","closed_at":"2025-12-10T17:44:28.019181+01:00","dependencies":[{"issue_id":"azul-85d.27","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:17:51.029611+01:00","created_by":"bkase"},{"issue_id":"azul-85d.27","depends_on_id":"azul-85d.20","type":"blocks","created_at":"2025-12-10T17:22:37.337493+01:00","created_by":"bkase"}]}
{"id":"azul-85d.28","title":"Implement TerminalOnly reward correctness tests","description":"Test TerminalOnly reward scheme (Section 12.3):\n1. Verify reward_t[p] == 0 for all non-terminal steps\n2. At terminal step:\n   - Σ_p reward_terminal[p] == 0 (zero-sum property)\n   - reward_terminal[p] == final_score[p] - mean(final_scores)\n3. Run multiple episodes to verify consistency","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:17:56.95433+01:00","updated_at":"2025-12-10T17:44:33.190762+01:00","closed_at":"2025-12-10T17:44:33.190762+01:00","dependencies":[{"issue_id":"azul-85d.28","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:17:56.954895+01:00","created_by":"bkase"},{"issue_id":"azul-85d.28","depends_on_id":"azul-85d.21","type":"blocks","created_at":"2025-12-10T17:22:42.467671+01:00","created_by":"bkase"}]}
{"id":"azul-85d.29","title":"Implement environment determinism tests","description":"Test determinism (Section 12.4):\nWith fixed RNG seed and fixed sequence of ActionIds:\n1. Run env.reset() + repeated env.step(action_id) twice with same seed\n2. Assert EnvStep.state (if included) identical across runs\n3. Assert observations identical across runs\n4. Assert rewards identical across runs\n5. Assert legal_action_masks identical\nThis ensures environment is pure given (seed, actions).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:18:05.015041+01:00","updated_at":"2025-12-10T17:44:38.339168+01:00","closed_at":"2025-12-10T17:44:38.339168+01:00","dependencies":[{"issue_id":"azul-85d.29","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:18:05.015566+01:00","created_by":"bkase"},{"issue_id":"azul-85d.29","depends_on_id":"azul-85d.19","type":"blocks","created_at":"2025-12-10T17:22:47.598069+01:00","created_by":"bkase"}]}
{"id":"azul-85d.3","title":"Implement EnvConfig struct","description":"Create EnvConfig struct with fields:\n- `num_players: u8` (2..=4, must match GameState.num_players)\n- `reward_scheme: RewardScheme` (reward computation strategy)\n- `include_full_state_in_step: bool` (if true, EnvStep.state contains full GameState clone for debugging)\nDerive Clone, Debug.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:13:25.468129+01:00","updated_at":"2025-12-10T17:39:22.447482+01:00","closed_at":"2025-12-10T17:39:22.447482+01:00","dependencies":[{"issue_id":"azul-85d.3","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:13:25.468666+01:00","created_by":"bkase"},{"issue_id":"azul-85d.3","depends_on_id":"azul-85d.2","type":"blocks","created_at":"2025-12-10T17:19:18.475111+01:00","created_by":"bkase"}]}
{"id":"azul-85d.30","title":"Implement illegal action handling tests","description":"Test illegal action handling (Section 12.6):\n1. Pick random states and random ActionIds\n2. If mask[id] == false, then env.step(id, rng) must return Err(StepError::IllegalAction(id))\n3. Confirm EpisodeDone is returned for step() calls after done == true\n4. Test edge cases: ActionId at boundary (299), invalid ActionId (\u003e= 300)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:18:27.499946+01:00","updated_at":"2025-12-10T17:44:43.495726+01:00","closed_at":"2025-12-10T17:44:43.495726+01:00","dependencies":[{"issue_id":"azul-85d.30","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:18:27.500489+01:00","created_by":"bkase"},{"issue_id":"azul-85d.30","depends_on_id":"azul-85d.19","type":"blocks","created_at":"2025-12-10T17:22:52.728173+01:00","created_by":"bkase"}]}
{"id":"azul-85d.31","title":"Implement integration smoke test","description":"Full integration test:\n1. Create AzulEnv with BasicFeatureExtractor and EnvConfig\n2. Run 100 complete random episodes with RandomAgent\n3. Verify no panics, all episodes terminate with done=true\n4. Verify observations are valid (correct shape, dtype)\n5. Verify rewards accumulate correctly\n6. Collect basic statistics: avg game length, avg final scores\nThis is the smoke test that ensures all components work together.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:18:35.293697+01:00","updated_at":"2025-12-10T17:44:48.65385+01:00","closed_at":"2025-12-10T17:44:48.65385+01:00","dependencies":[{"issue_id":"azul-85d.31","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:18:35.294235+01:00","created_by":"bkase"},{"issue_id":"azul-85d.31","depends_on_id":"azul-85d.24","type":"blocks","created_at":"2025-12-10T17:22:59.733068+01:00","created_by":"bkase"},{"issue_id":"azul-85d.31","depends_on_id":"azul-85d.19","type":"blocks","created_at":"2025-12-10T17:23:04.856329+01:00","created_by":"bkase"},{"issue_id":"azul-85d.31","depends_on_id":"azul-85d.12","type":"blocks","created_at":"2025-12-10T17:23:09.992889+01:00","created_by":"bkase"}]}
{"id":"azul-85d.32","title":"Define Transition struct for replay buffer","description":"Create Transition struct for storing experience:\n```rust\npub struct Transition {\n    pub player: PlayerIdx,\n    pub observation_before: Observation,\n    pub action_id: ActionId,\n    pub reward: Reward,\n    pub observation_after: Observation,\n    pub done: bool,\n}\n```\nUsed by self_play_episode to collect training data.\nClone-able for replay buffer storage.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T17:18:41.36019+01:00","updated_at":"2025-12-10T17:41:31.11899+01:00","closed_at":"2025-12-10T17:41:31.11899+01:00","dependencies":[{"issue_id":"azul-85d.32","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:18:41.36076+01:00","created_by":"bkase"},{"issue_id":"azul-85d.32","depends_on_id":"azul-85d.1","type":"blocks","created_at":"2025-12-10T17:22:19.915854+01:00","created_by":"bkase"}]}
{"id":"azul-85d.33","title":"Set up rl_env module structure","description":"Create module structure for RL environment code:\n1. Create src/rl_env/mod.rs with public re-exports\n2. Create src/rl_env/types.rs for ActionId, Reward, Observation, RewardScheme, EnvConfig\n3. Create src/rl_env/action_encoder.rs for ActionEncoder\n4. Create src/rl_env/feature_extractor.rs for FeatureExtractor trait + BasicFeatureExtractor\n5. Create src/rl_env/environment.rs for Environment trait + AzulEnv\n6. Create src/rl_env/agent.rs for AgentInput, Agent trait, RandomAgent\n7. Update src/lib.rs to include pub mod rl_env\nThis establishes clean code organization before implementation.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T17:18:47.327852+01:00","updated_at":"2025-12-10T17:39:06.953982+01:00","closed_at":"2025-12-10T17:39:06.953982+01:00","dependencies":[{"issue_id":"azul-85d.33","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:18:47.328448+01:00","created_by":"bkase"}]}
{"id":"azul-85d.4","title":"Implement StepError enum","description":"Create StepError enum with variants:\n- `EpisodeDone`: step() called after episode has already terminated\n- `InvalidActionId(ActionId)`: ActionId could not be decoded into syntactically valid Action\n- `IllegalAction(ActionId)`: ActionId decodes to Action which is illegal in current state\nDerive Debug. Used as error type for Environment::step().","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:13:31.527621+01:00","updated_at":"2025-12-10T17:39:27.607504+01:00","closed_at":"2025-12-10T17:39:27.607504+01:00","dependencies":[{"issue_id":"azul-85d.4","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:13:31.528165+01:00","created_by":"bkase"},{"issue_id":"azul-85d.4","depends_on_id":"azul-85d.1","type":"blocks","created_at":"2025-12-10T17:19:23.60273+01:00","created_by":"bkase"}]}
{"id":"azul-85d.5","title":"Implement EnvStep struct","description":"Create EnvStep\u003cO, R\u003e struct with fields:\n- `observations: [O; MAX_PLAYERS]` - observation per player from that player's perspective\n- `rewards: [R; MAX_PLAYERS]` - reward per player for most recent transition (zeros on reset)\n- `done: bool` - true if episode has terminated\n- `current_player: PlayerIdx` - player whose turn it is after this step\n- `legal_action_mask: Vec\u003cbool\u003e` - mask[id]=true if ActionId legal for current_player\n- `last_action: Option\u003cActionId\u003e` - last action taken (None on reset)\n- `state: Option\u003cGameState\u003e` - optional full state for debugging","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:13:38.379934+01:00","updated_at":"2025-12-10T17:39:32.684215+01:00","closed_at":"2025-12-10T17:39:32.684215+01:00","dependencies":[{"issue_id":"azul-85d.5","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:13:38.380438+01:00","created_by":"bkase"},{"issue_id":"azul-85d.5","depends_on_id":"azul-85d.1","type":"blocks","created_at":"2025-12-10T17:19:28.724042+01:00","created_by":"bkase"}]}
{"id":"azul-85d.6","title":"Define ACTION_SPACE_SIZE and encoding constants","description":"Define action encoding constants:\n- `pub const ACTION_SPACE_SIZE: usize = 300;`\nEncoding formula: id = ((((s_type * MAX_FACTORIES + s_idx) * TILE_COLORS + c_idx) * 2 + d_type) * BOARD_SIZE + d_idx)\nWhere: s_type∈{0,1} (Factory/Center), s_idx∈0..9, c_idx∈0..5, d_type∈{0,1} (PatternLine/Floor), d_idx∈0..5\nResult: (9+1) * 5 * 2 * 5 = 300 total action IDs covering all syntactically possible draft moves.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:14:03.596631+01:00","updated_at":"2025-12-10T17:39:45.86349+01:00","closed_at":"2025-12-10T17:39:45.86349+01:00","dependencies":[{"issue_id":"azul-85d.6","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:14:03.597169+01:00","created_by":"bkase"},{"issue_id":"azul-85d.6","depends_on_id":"azul-85d.1","type":"blocks","created_at":"2025-12-10T17:19:35.982726+01:00","created_by":"bkase"}]}
{"id":"azul-85d.7","title":"Implement ActionEncoder::encode","description":"Implement ActionEncoder::encode(\u0026Action) -\u003e ActionId method:\n1. Extract s_type (0=Factory, 1=Center) and s_idx from action.source\n2. Extract c_idx from action.color as u16\n3. Extract d_type (0=PatternLine, 1=Floor) and d_idx from action.dest\n4. Pack: id = ((((s_type * MAX_FACTORIES + s_idx) * TILE_COLORS + c_idx) * 2 + d_type) * BOARD_SIZE + d_idx)\n5. debug_assert!(id \u003c ACTION_SPACE_SIZE)\nReturn ActionId. Panics in debug if indices out of range.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:14:10.447551+01:00","updated_at":"2025-12-10T17:39:50.918528+01:00","closed_at":"2025-12-10T17:39:50.918528+01:00","dependencies":[{"issue_id":"azul-85d.7","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:14:10.448138+01:00","created_by":"bkase"},{"issue_id":"azul-85d.7","depends_on_id":"azul-85d.6","type":"blocks","created_at":"2025-12-10T17:19:41.104027+01:00","created_by":"bkase"}]}
{"id":"azul-85d.8","title":"Implement ActionEncoder::decode","description":"Implement ActionEncoder::decode(ActionId) -\u003e Action method:\n1. assert!(id \u003c ACTION_SPACE_SIZE)\n2. Unpack in reverse order: d_idx = x % BOARD_SIZE; x /= BOARD_SIZE; d_type = x % 2; x /= 2; etc.\n3. Reconstruct DraftSource from s_type/s_idx (0=Factory(s_idx), 1=Center)\n4. Reconstruct Color using Color::from_index(c_idx) \n5. Reconstruct DraftDestination from d_type/d_idx (0=PatternLine(d_idx), 1=Floor)\nReturn Action. May produce syntactically valid but illegal actions - env must mask.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T17:14:16.886692+01:00","updated_at":"2025-12-10T17:39:55.973688+01:00","closed_at":"2025-12-10T17:39:55.973688+01:00","dependencies":[{"issue_id":"azul-85d.8","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:14:16.887338+01:00","created_by":"bkase"},{"issue_id":"azul-85d.8","depends_on_id":"azul-85d.6","type":"blocks","created_at":"2025-12-10T17:19:46.227603+01:00","created_by":"bkase"}]}
{"id":"azul-85d.9","title":"Implement ActionEncoder unit tests","description":"Property-based tests for ActionEncoder:\n1. Round-trip test: For random valid Actions, assert decode(encode(a)) == a\n2. Decode bounds test: For all id in 0..ACTION_SPACE_SIZE, decode(id) produces Action with valid field ranges\n3. Encode produces valid range: For all valid Actions, encode(a) \u003c ACTION_SPACE_SIZE\n4. Edge cases: Test boundary conditions (factory 0, factory 8, center, all colors, all pattern lines, floor)\nUse proptest or quickcheck for randomized coverage.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T17:14:24.64598+01:00","updated_at":"2025-12-10T17:45:36.219321+01:00","closed_at":"2025-12-10T17:45:36.219321+01:00","dependencies":[{"issue_id":"azul-85d.9","depends_on_id":"azul-85d","type":"parent-child","created_at":"2025-12-10T17:14:24.646584+01:00","created_by":"bkase"},{"issue_id":"azul-85d.9","depends_on_id":"azul-85d.7","type":"blocks","created_at":"2025-12-10T17:19:51.361506+01:00","created_by":"bkase"},{"issue_id":"azul-85d.9","depends_on_id":"azul-85d.8","type":"blocks","created_at":"2025-12-10T17:19:56.489928+01:00","created_by":"bkase"}]}
{"id":"azul-9sh","title":"Game Spec \u0026 Design","description":"Formalize Azul game rules, state representation, action space, and victory conditions","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-09T21:14:27.05717+01:00","updated_at":"2025-12-09T21:14:27.05717+01:00","labels":["design","spec"]}
{"id":"azul-e9k","title":"Game Engine","description":"Core game logic, rules, state management, move validation for Azul board game","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-09T21:14:20.747626+01:00","updated_at":"2025-12-09T22:28:07.24422+01:00","closed_at":"2025-12-09T22:28:07.24422+01:00","labels":["game-engine","rust"]}
{"id":"azul-e9k.1","title":"Basic types and constants","description":"Implement Section 3.1: PlayerIdx, Row, Col types; BOARD_SIZE, MAX_PLAYERS, MAX_FACTORIES, FACTORY_CAPACITY, FLOOR_CAPACITY, TILE_COLORS, TILES_PER_COLOR constants; Color enum with Blue/Yellow/Red/Black/Teal; ALL_COLORS array; FLOOR_PENALTY array [-1,-1,-2,-2,-2,-3,-3]; Phase enum (FactoryOffer, GameOver)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:05:58.750996+01:00","updated_at":"2025-12-09T22:21:07.62733+01:00","closed_at":"2025-12-09T22:21:07.62733+01:00","dependencies":[{"issue_id":"azul-e9k.1","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:05:58.751696+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.10","title":"legal_actions function","description":"Implement Section 5.2: legal_actions(state) -\u003e Vec\u003cAction\u003e. Enumerate all (source, color) pairs from factories and center. For each, compute allowed destinations checking: wall constraint (color not already in row), pattern line homogeneity, line not full. Always allow Floor destination","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:07:16.602702+01:00","updated_at":"2025-12-09T22:21:55.531897+01:00","closed_at":"2025-12-09T22:21:55.531897+01:00","dependencies":[{"issue_id":"azul-e9k.10","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:07:16.603265+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.10","depends_on_id":"azul-e9k.6","type":"blocks","created_at":"2025-12-09T22:11:50.372633+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.10","depends_on_id":"azul-e9k.7","type":"blocks","created_at":"2025-12-09T22:11:56.507516+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.10","depends_on_id":"azul-e9k.2","type":"blocks","created_at":"2025-12-09T22:12:03.015404+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.11","title":"apply_action function - validity checks","description":"Implement Section 5.3.1: Check phase == FactoryOffer, validate action is in legal_actions. Return ApplyError enum (NotPlayersTurn, WrongPhase, IllegalAction) on failure","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:07:22.843467+01:00","updated_at":"2025-12-09T22:22:02.602017+01:00","closed_at":"2025-12-09T22:22:02.602017+01:00","dependencies":[{"issue_id":"azul-e9k.11","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:07:22.844335+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.11","depends_on_id":"azul-e9k.10","type":"blocks","created_at":"2025-12-09T22:12:09.540341+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.12","title":"apply_action - extract tiles from source","description":"Implement Section 5.3.2 part 1: Extract tiles of chosen color from factory (move others to center) or from center (also take first player marker if present and not yet taken this round). Track took_first_player_marker flag","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:07:29.086386+01:00","updated_at":"2025-12-09T22:22:07.723771+01:00","closed_at":"2025-12-09T22:22:07.723771+01:00","dependencies":[{"issue_id":"azul-e9k.12","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:07:29.086917+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.12","depends_on_id":"azul-e9k.6","type":"blocks","created_at":"2025-12-09T22:12:15.587498+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.13","title":"apply_action - place tiles into destination","description":"Implement Section 5.3.2 part 2: Place tiles into Floor (overflow to discard) or PatternLine (fill up to capacity, overflow to floor then discard). Handle first player marker placement on floor","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:07:35.338018+01:00","updated_at":"2025-12-09T22:22:12.852081+01:00","closed_at":"2025-12-09T22:22:12.852081+01:00","dependencies":[{"issue_id":"azul-e9k.13","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:07:35.338804+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.13","depends_on_id":"azul-e9k.12","type":"blocks","created_at":"2025-12-09T22:12:22.076202+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.14","title":"apply_action - round end check and player advance","description":"Implement Section 5.3.2 part 3: After action, if all factories empty and center has no tiles, call resolve_end_of_round. Otherwise advance current_player to next. Return StepResult with state and optional final_scores","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:07:41.626585+01:00","updated_at":"2025-12-09T22:22:17.980027+01:00","closed_at":"2025-12-09T22:22:17.980027+01:00","dependencies":[{"issue_id":"azul-e9k.14","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:07:41.627315+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.14","depends_on_id":"azul-e9k.11","type":"blocks","created_at":"2025-12-09T22:12:39.390831+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.14","depends_on_id":"azul-e9k.13","type":"blocks","created_at":"2025-12-09T22:12:44.499253+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.15","title":"resolve_end_of_round - wall tiling","description":"Implement Section 5.3.3 step 1: For each player, for each complete pattern line, move rightmost tile to wall at correct column (via WALL_DEST_COL), call score_placement, discard remaining tiles (cap-1), reset pattern line","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:08:05.780583+01:00","updated_at":"2025-12-09T22:22:23.092679+01:00","closed_at":"2025-12-09T22:22:23.092679+01:00","dependencies":[{"issue_id":"azul-e9k.15","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:08:05.78158+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.15","depends_on_id":"azul-e9k.6","type":"blocks","created_at":"2025-12-09T22:12:50.784239+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.15","depends_on_id":"azul-e9k.2","type":"blocks","created_at":"2025-12-09T22:12:55.903224+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.15","depends_on_id":"azul-e9k.16","type":"blocks","created_at":"2025-12-09T22:13:01.916749+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.16","title":"score_placement function","description":"Implement placement scoring per Section 2.2: Count contiguous tiles horizontally and vertically including placed tile. If both counts are 1 (isolated), score 1. Otherwise score (horiz\u003e1 ? horiz : 0) + (vert\u003e1 ? vert : 0)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:08:11.808638+01:00","updated_at":"2025-12-09T22:22:29.67786+01:00","closed_at":"2025-12-09T22:22:29.67786+01:00","dependencies":[{"issue_id":"azul-e9k.16","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:08:11.809608+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.16","depends_on_id":"azul-e9k.5","type":"blocks","created_at":"2025-12-09T22:13:08.122752+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.17","title":"resolve_end_of_round - floor penalties","description":"Implement Section 5.3.3 step 2: For each player, apply FLOOR_PENALTY for each floor slot, clamp score \u003e= 0. Discard floor tiles, track first player marker holder to set starting_player_next_round","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:08:18.006304+01:00","updated_at":"2025-12-09T22:22:34.792473+01:00","closed_at":"2025-12-09T22:22:34.792473+01:00","dependencies":[{"issue_id":"azul-e9k.17","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:08:18.007203+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.17","depends_on_id":"azul-e9k.15","type":"blocks","created_at":"2025-12-09T22:13:15.052155+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.18","title":"resolve_end_of_round - game end check","description":"Implement Section 5.3.3 step 3: Check if any player has complete horizontal wall row (5 tiles). If so, set final_round_triggered=true, call apply_final_scoring, set phase=GameOver, return scores","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:08:24.332323+01:00","updated_at":"2025-12-09T22:22:39.908433+01:00","closed_at":"2025-12-09T22:22:39.908433+01:00","dependencies":[{"issue_id":"azul-e9k.18","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:08:24.33289+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.18","depends_on_id":"azul-e9k.17","type":"blocks","created_at":"2025-12-09T22:13:21.36313+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.18","depends_on_id":"azul-e9k.21","type":"blocks","created_at":"2025-12-09T22:13:26.466172+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.19","title":"resolve_end_of_round - prepare next round","description":"Implement Section 5.3.3 step 4: Increment round, call refill_factories, clear center and add first player marker, set current_player = starting_player_next_round, set phase = FactoryOffer","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:08:30.353224+01:00","updated_at":"2025-12-09T22:22:45.057107+01:00","closed_at":"2025-12-09T22:22:45.057107+01:00","dependencies":[{"issue_id":"azul-e9k.19","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:08:30.353804+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.19","depends_on_id":"azul-e9k.18","type":"blocks","created_at":"2025-12-09T22:13:34.100487+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.19","depends_on_id":"azul-e9k.20","type":"blocks","created_at":"2025-12-09T22:13:39.209449+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.2","title":"Wall layout constants","description":"Implement Section 3.2: WALL_PATTERN 5x5 matrix defining color positions (Latin-square pattern); WALL_DEST_COL lookup array mapping (row, color) -\u003e column; precompute at compile time or hand-code","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:06:05.040923+01:00","updated_at":"2025-12-09T22:21:12.742053+01:00","closed_at":"2025-12-09T22:21:12.742053+01:00","dependencies":[{"issue_id":"azul-e9k.2","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:06:05.041469+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.2","depends_on_id":"azul-e9k.1","type":"blocks","created_at":"2025-12-09T22:10:26.649474+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.20","title":"refill_factories function","description":"Implement factory refill: Draw 4 tiles per factory from bag. If bag empties mid-draw, move all discard to bag and continue. If both empty, leave factories partially filled","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:08:36.536319+01:00","updated_at":"2025-12-09T22:22:50.219387+01:00","closed_at":"2025-12-09T22:22:50.219387+01:00","dependencies":[{"issue_id":"azul-e9k.20","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:08:36.536816+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.20","depends_on_id":"azul-e9k.9","type":"blocks","created_at":"2025-12-09T22:13:45.216645+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.21","title":"apply_final_scoring function","description":"Implement Section 5.3.4: For each player add +2 per complete horizontal row (5 tiles), +7 per complete vertical column, +10 per color with all 5 tiles on wall. Return scores array","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:08:43.316123+01:00","updated_at":"2025-12-09T22:22:55.375988+01:00","closed_at":"2025-12-09T22:22:55.375988+01:00","dependencies":[{"issue_id":"azul-e9k.21","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:08:43.316654+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.21","depends_on_id":"azul-e9k.5","type":"blocks","created_at":"2025-12-09T22:13:52.537664+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.22","title":"Test: Tile count invariants","description":"Implement debug assertion tests per Section 8.2: For each color, verify bag + discard + factories + center + player boards = 20. Run after every apply_action in debug builds","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:09:12.810276+01:00","updated_at":"2025-12-09T22:26:36.147394+01:00","closed_at":"2025-12-09T22:26:36.147394+01:00","dependencies":[{"issue_id":"azul-e9k.22","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:09:12.810846+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.22","depends_on_id":"azul-e9k.14","type":"blocks","created_at":"2025-12-09T22:14:10.257823+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.23","title":"Test: Pattern line and floor invariants","description":"Implement Section 8.2 tests: floor.len \u003c= 7; pattern line count \u003c= capacity; count==0 iff color==None; wall positions match WALL_PATTERN colors; player indices valid","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:09:19.22551+01:00","updated_at":"2025-12-09T22:26:41.201909+01:00","closed_at":"2025-12-09T22:26:41.201909+01:00","dependencies":[{"issue_id":"azul-e9k.23","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:09:19.225969+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.23","depends_on_id":"azul-e9k.6","type":"blocks","created_at":"2025-12-09T22:14:16.565093+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.24","title":"Test: Placement scoring scenarios","description":"Per Section 8.3: Test score_placement with isolated tile (=1), horizontal group, vertical group, cross shape. Verify adjacency counting is correct","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:09:25.320175+01:00","updated_at":"2025-12-09T22:26:46.257882+01:00","closed_at":"2025-12-09T22:26:46.257882+01:00","dependencies":[{"issue_id":"azul-e9k.24","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:09:25.320644+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.24","depends_on_id":"azul-e9k.16","type":"blocks","created_at":"2025-12-09T22:14:22.459875+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.25","title":"Test: Floor penalty calculation","description":"Test full floor of 7 tiles gives penalty -14 (-1-1-2-2-2-3-3). Verify score clamps to \u003e= 0. Test partial floor penalties","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:09:31.564862+01:00","updated_at":"2025-12-09T22:26:51.411217+01:00","closed_at":"2025-12-09T22:26:51.411217+01:00","dependencies":[{"issue_id":"azul-e9k.25","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:09:31.565415+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.25","depends_on_id":"azul-e9k.17","type":"blocks","created_at":"2025-12-09T22:14:28.615106+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.26","title":"Test: Endgame bonus calculation","description":"Test apply_final_scoring: +2 per horizontal row, +7 per vertical column, +10 per complete color set. Test player with 1 row + 1 column + 1 color = +19","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:09:37.76383+01:00","updated_at":"2025-12-09T22:26:56.571087+01:00","closed_at":"2025-12-09T22:26:56.571087+01:00","dependencies":[{"issue_id":"azul-e9k.26","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:09:37.764748+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.26","depends_on_id":"azul-e9k.21","type":"blocks","created_at":"2025-12-09T22:14:35.182524+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.27","title":"Test: Factory refill from depleted bag","description":"Test refill_factories when bag has few tiles, discard has rest. Verify tiles move from discard to bag mid-refill. Test edge case where both empty","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:09:43.873296+01:00","updated_at":"2025-12-09T22:27:35.925321+01:00","closed_at":"2025-12-09T22:27:35.925321+01:00","dependencies":[{"issue_id":"azul-e9k.27","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:09:43.873839+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.27","depends_on_id":"azul-e9k.20","type":"blocks","created_at":"2025-12-09T22:14:41.279712+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.28","title":"Test: Legal actions enumeration","description":"Test legal_actions respects: wall constraint (can't place color already in wall row), pattern line homogeneity, line capacity. Test Floor always available","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:09:50.177818+01:00","updated_at":"2025-12-09T22:27:40.992146+01:00","closed_at":"2025-12-09T22:27:40.992146+01:00","dependencies":[{"issue_id":"azul-e9k.28","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:09:50.178457+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.28","depends_on_id":"azul-e9k.10","type":"blocks","created_at":"2025-12-09T22:14:47.608453+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.29","title":"Test: First player marker mechanics","description":"Test: marker starts in center, first center pick takes it, marker goes to floor, marker holder becomes next round starter, marker incurs floor penalty","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:09:56.253863+01:00","updated_at":"2025-12-09T22:27:46.150321+01:00","closed_at":"2025-12-09T22:27:46.150321+01:00","dependencies":[{"issue_id":"azul-e9k.29","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:09:56.254879+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.29","depends_on_id":"azul-e9k.19","type":"blocks","created_at":"2025-12-09T22:14:54.654256+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.3","title":"Factory and Center data structures","description":"Implement Section 3.3: Factory struct (len: u8, tiles: [Color; 4]); Factories struct (num_factories: u8, factories: [Factory; 9]); Token enum (Tile(Color), FirstPlayerMarker); CenterPool struct (len: u8, items: [Token; 100])","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:06:11.212524+01:00","updated_at":"2025-12-09T22:21:17.86716+01:00","closed_at":"2025-12-09T22:21:17.86716+01:00","dependencies":[{"issue_id":"azul-e9k.3","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:06:11.213143+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.3","depends_on_id":"azul-e9k.1","type":"blocks","created_at":"2025-12-09T22:10:32.681968+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.30","title":"Test: Full game simulation","description":"Run multiple complete games (2/3/4 players) with random legal moves until GameOver. Verify no panics, invariants hold throughout, final scores computed correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:10:02.30987+01:00","updated_at":"2025-12-09T22:27:51.277291+01:00","closed_at":"2025-12-09T22:27:51.277291+01:00","dependencies":[{"issue_id":"azul-e9k.30","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:10:02.310319+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.30","depends_on_id":"azul-e9k.19","type":"blocks","created_at":"2025-12-09T22:15:00.832937+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.30","depends_on_id":"azul-e9k.8","type":"blocks","created_at":"2025-12-09T22:15:05.940189+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.31","title":"Test: Deterministic replay","description":"Given same RNG seed and action sequence, verify game plays out identically. Important for RL reproducibility","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:10:08.745559+01:00","updated_at":"2025-12-09T22:27:56.396647+01:00","closed_at":"2025-12-09T22:27:56.396647+01:00","dependencies":[{"issue_id":"azul-e9k.31","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:10:08.746143+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.31","depends_on_id":"azul-e9k.30","type":"blocks","created_at":"2025-12-09T22:15:11.980142+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.4","title":"TileSupply (bag and discard)","description":"Implement Section 3.4: TileSupply struct with bag: [u8; 5] and discard: [u8; 5] for color counts; document tile count invariant (bag + discard + factories + center + players = 20 per color)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:06:17.335361+01:00","updated_at":"2025-12-09T22:21:22.993975+01:00","closed_at":"2025-12-09T22:21:22.993975+01:00","dependencies":[{"issue_id":"azul-e9k.4","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:06:17.335944+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.4","depends_on_id":"azul-e9k.1","type":"blocks","created_at":"2025-12-09T22:10:38.710219+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.5","title":"Player board state structures","description":"Implement Section 3.5: PatternLine struct (color: Option\u003cColor\u003e, count: u8); Wall type as [[Option\u003cColor\u003e; 5]; 5]; FloorLine struct (len: u8, slots: [Token; 7]); PlayerState struct (wall, pattern_lines, floor, score: i16)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:06:23.387045+01:00","updated_at":"2025-12-09T22:21:28.119061+01:00","closed_at":"2025-12-09T22:21:28.119061+01:00","dependencies":[{"issue_id":"azul-e9k.5","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:06:23.387614+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.5","depends_on_id":"azul-e9k.1","type":"blocks","created_at":"2025-12-09T22:10:44.86358+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.5","depends_on_id":"azul-e9k.3","type":"blocks","created_at":"2025-12-09T22:10:51.279464+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.6","title":"Top-level GameState struct","description":"Implement Section 3.6: GameState struct combining all components - num_players, players array, factories, center, supply, current_player, starting_player_next_round, phase, round counter, final_round_triggered flag","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:06:30.107555+01:00","updated_at":"2025-12-09T22:21:35.019051+01:00","closed_at":"2025-12-09T22:21:35.019051+01:00","dependencies":[{"issue_id":"azul-e9k.6","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:06:30.108062+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.6","depends_on_id":"azul-e9k.3","type":"blocks","created_at":"2025-12-09T22:10:57.764519+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.6","depends_on_id":"azul-e9k.4","type":"blocks","created_at":"2025-12-09T22:11:03.834561+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.6","depends_on_id":"azul-e9k.5","type":"blocks","created_at":"2025-12-09T22:11:09.978924+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.7","title":"Action representation","description":"Implement Section 4: DraftSource enum (Factory(u8), Center); DraftDestination enum (PatternLine(Row), Floor); Action struct (source, color, dest). Tiles taken implied by board state, overflow to floor is automatic","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:06:36.590845+01:00","updated_at":"2025-12-09T22:21:40.146827+01:00","closed_at":"2025-12-09T22:21:40.146827+01:00","dependencies":[{"issue_id":"azul-e9k.7","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:06:36.591414+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.7","depends_on_id":"azul-e9k.1","type":"blocks","created_at":"2025-12-09T22:11:15.893134+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.8","title":"new_game function","description":"Implement Section 5.1: new_game(num_players, starting_player, rng) -\u003e GameState. Initialize empty player states, bag with 20 tiles per color, draw 4 tiles per factory (5/7/9 factories for 2/3/4 players), place first player marker in center, set phase to FactoryOffer","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:07:02.160076+01:00","updated_at":"2025-12-09T22:21:45.281736+01:00","closed_at":"2025-12-09T22:21:45.281736+01:00","dependencies":[{"issue_id":"azul-e9k.8","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:07:02.160992+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.8","depends_on_id":"azul-e9k.6","type":"blocks","created_at":"2025-12-09T22:11:31.930413+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.8","depends_on_id":"azul-e9k.9","type":"blocks","created_at":"2025-12-09T22:11:38.046268+01:00","created_by":"bkase"}]}
{"id":"azul-e9k.9","title":"Random tile drawing helper","description":"Implement helper function to draw N random tiles from bag. When bag empties, refill from discard. Handle partial fills if both empty. Used by new_game and refill_factories","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T22:07:09.849299+01:00","updated_at":"2025-12-09T22:21:50.403363+01:00","closed_at":"2025-12-09T22:21:50.403363+01:00","dependencies":[{"issue_id":"azul-e9k.9","depends_on_id":"azul-e9k","type":"parent-child","created_at":"2025-12-09T22:07:09.850121+01:00","created_by":"bkase"},{"issue_id":"azul-e9k.9","depends_on_id":"azul-e9k.4","type":"blocks","created_at":"2025-12-09T22:11:44.291162+01:00","created_by":"bkase"}]}
{"id":"azul-jba","title":"Training Pipeline","description":"Implement training loop, reward shaping, policy optimization, and model checkpointing","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-09T21:14:39.382282+01:00","updated_at":"2025-12-09T21:14:39.382282+01:00","labels":["mlx","rl","training"]}
{"id":"azul-sic","title":"MLX \u0026 Rust Integration","description":"Set up MLX for learning, Rust bindings, and performance optimization infrastructure","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-09T21:14:45.219484+01:00","updated_at":"2025-12-09T21:14:45.219484+01:00","labels":["infrastructure","mlx","rust"]}
